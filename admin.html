<!DOCTYPE HTML>
<html>
<head>
    <title>FlowFix Labs - Admin Dashboard</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #374151;
            background: #f9fafb;
            min-height: 100vh;
        }

        .admin-header {
            background: #1f2937;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .admin-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .admin-header p {
            color: #9ca3af;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .card-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }

        .card-header p {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .card-content {
            padding: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .user-table th,
        .user-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .user-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }

        .user-table td {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .user-table tr:hover {
            background: #f9fafb;
        }

        .auth-method {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .auth-google {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .auth-email {
            background: #dcfce7;
            color: #16a34a;
        }

        .business-type {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .business-user {
            background: #fef3c7;
            color: #d97706;
        }

        .individual-user {
            background: #e0e7ff;
            color: #4338ca;
        }

        .export-button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 1rem;
        }

        .export-button:hover {
            background: #1d4ed8;
        }

        .no-data {
            text-align: center;
            color: #6b7280;
            padding: 2rem;
            font-style: italic;
        }

        .refresh-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            margin-left: 1rem;
        }

        .refresh-button:hover {
            background: #059669;
        }

        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .filter-select {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background: white;
        }

        @media (max-width: 768px) {
            .admin-container {
                padding: 1rem;
            }
            
            .user-table {
                font-size: 0.75rem;
            }
            
            .user-table th,
            .user-table td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <h1>FlowFix Labs - Admin Dashboard</h1>
        <p>User Registration Data & Marketing Analytics</p>
    </header>

    <div class="admin-container">
        <!-- Statistics Overview -->
        <div class="admin-card">
            <div class="card-header">
                <h2>Registration Statistics</h2>
                <p>Overview of user registrations and marketing data</p>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="businessUsers">0</div>
                        <div class="stat-label">Business Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="individualUsers">0</div>
                        <div class="stat-label">Individual Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="googleUsers">0</div>
                        <div class="stat-label">Google Auth</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="emailUsers">0</div>
                        <div class="stat-label">Email Auth</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="withPhone">0</div>
                        <div class="stat-label">With Phone</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Data Table -->
        <div class="admin-card">
            <div class="card-header">
                <h2>User Registration Data</h2>
                <p>Detailed user information for marketing purposes</p>
                <button class="refresh-button" onclick="loadUserData()">Refresh Data</button>
            </div>
            <div class="card-content">
                <button class="export-button" onclick="exportUserData()">Export to CSV</button>
                
                <!-- Filters -->
                <div class="filter-section">
                    <input type="text" class="filter-input" id="nameFilter" placeholder="Filter by name..." onkeyup="filterUsers()">
                    <input type="text" class="filter-input" id="emailFilter" placeholder="Filter by email..." onkeyup="filterUsers()">
                    <select class="filter-select" id="authFilter" onchange="filterUsers()">
                        <option value="">All Auth Methods</option>
                        <option value="google">Google</option>
                        <option value="email">Email</option>
                    </select>
                    <select class="filter-select" id="typeFilter" onchange="filterUsers()">
                        <option value="">All User Types</option>
                        <option value="business">Business Users</option>
                        <option value="individual">Individual Users</option>
                    </select>
                </div>

                <div id="userTableContainer">
                    <div class="no-data">Loading user data...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allUsers = [];
        let filteredUsers = [];

        // Load user data from localStorage
        function loadUserData() {
            try {
                const registrations = JSON.parse(localStorage.getItem('userRegistrations') || '[]');
                allUsers = registrations;
                filteredUsers = [...allUsers];
                updateStatistics();
                renderUserTable();
            } catch (error) {
                console.error('Error loading user data:', error);
                document.getElementById('userTableContainer').innerHTML = '<div class="no-data">Error loading user data</div>';
            }
        }

        // Update statistics
        function updateStatistics() {
            const totalUsers = allUsers.length;
            const businessUsers = allUsers.filter(user => user.company && user.company.trim() !== '').length;
            const individualUsers = totalUsers - businessUsers;
            const googleUsers = allUsers.filter(user => user.authMethod === 'google').length;
            const emailUsers = allUsers.filter(user => user.authMethod === 'email').length;
            const withPhone = allUsers.filter(user => user.phone && user.phone.trim() !== '').length;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('businessUsers').textContent = businessUsers;
            document.getElementById('individualUsers').textContent = individualUsers;
            document.getElementById('googleUsers').textContent = googleUsers;
            document.getElementById('emailUsers').textContent = emailUsers;
            document.getElementById('withPhone').textContent = withPhone;
        }

        // Render user table
        function renderUserTable() {
            const container = document.getElementById('userTableContainer');
            
            if (filteredUsers.length === 0) {
                container.innerHTML = '<div class="no-data">No user registrations found</div>';
                return;
            }

            const table = document.createElement('table');
            table.className = 'user-table';
            
            // Table header
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Company</th>
                        <th>Phone</th>
                        <th>Interests</th>
                        <th>Auth Method</th>
                        <th>User Type</th>
                        <th>Registration Date</th>
                    </tr>
                </thead>
                <tbody>
                    ${filteredUsers.map(user => `
                        <tr>
                            <td><strong>${user.name || 'N/A'}</strong></td>
                            <td>${user.email || 'N/A'}</td>
                            <td>${user.company || 'Not provided'}</td>
                            <td>${user.phone || 'Not provided'}</td>
                            <td>${user.interests || 'Not specified'}</td>
                            <td>
                                <span class="auth-method auth-${user.authMethod}">
                                    ${user.authMethod === 'google' ? 'Google' : 'Email'}
                                </span>
                            </td>
                            <td>
                                <span class="business-type ${user.company ? 'business-user' : 'individual-user'}">
                                    ${user.company ? 'Business' : 'Individual'}
                                </span>
                            </td>
                            <td>${new Date(user.loginTime).toLocaleDateString()}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            
            container.innerHTML = '';
            container.appendChild(table);
        }

        // Filter users
        function filterUsers() {
            const nameFilter = document.getElementById('nameFilter').value.toLowerCase();
            const emailFilter = document.getElementById('emailFilter').value.toLowerCase();
            const authFilter = document.getElementById('authFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;

            filteredUsers = allUsers.filter(user => {
                const matchesName = !nameFilter || (user.name && user.name.toLowerCase().includes(nameFilter));
                const matchesEmail = !emailFilter || (user.email && user.email.toLowerCase().includes(emailFilter));
                const matchesAuth = !authFilter || user.authMethod === authFilter;
                const matchesType = !typeFilter || 
                    (typeFilter === 'business' && user.company && user.company.trim() !== '') ||
                    (typeFilter === 'individual' && (!user.company || user.company.trim() === ''));

                return matchesName && matchesEmail && matchesAuth && matchesType;
            });

            renderUserTable();
        }

        // Export user data to CSV
        function exportUserData() {
            if (filteredUsers.length === 0) {
                alert('No data to export');
                return;
            }

            const headers = [
                'Name', 'Email', 'Company', 'Phone', 'Marketing Interests', 
                'Auth Method', 'User Type', 'Registration Date', 'User ID', 
                'Google ID', 'Registration ID'
            ];

            const csvContent = [
                headers.join(','),
                ...filteredUsers.map(user => [
                    `"${user.name || ''}"`,
                    `"${user.email || ''}"`,
                    `"${user.company || ''}"`,
                    `"${user.phone || ''}"`,
                    `"${user.interests || ''}"`,
                    `"${user.authMethod || ''}"`,
                    `"${user.company ? 'Business' : 'Individual'}"`,
                    `"${new Date(user.loginTime).toLocaleDateString()}"`,
                    `"${user.userId || ''}"`,
                    `"${user.googleId || ''}"`,
                    `"${user.registrationId || ''}"`
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `flowfix-users-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
        });
    </script>
</body>
</html>
